{"remainingRequest":"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/biyue/Documents/LanHuo/LanHuo-biyue/src/views/nested/alarmMana/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/biyue/Documents/LanHuo/LanHuo-biyue/src/views/nested/alarmMana/index.vue","mtime":1557731454676},{"path":"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty = require(\"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/@babel/runtime-corejs2/core-js/object/define-property\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = void 0;\n\nvar _parseInt2 = _interopRequireDefault(require(\"/Users/biyue/Documents/LanHuo/LanHuo-biyue/node_modules/@babel/runtime-corejs2/core-js/parse-int\"));\n\nvar _api = _interopRequireDefault(require(\"@/api/hardware/api.js\"));\n\nvar _fileSaver = _interopRequireDefault(require(\"file-saver\"));\n\nvar _xlsx = _interopRequireDefault(require(\"xlsx\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// import '../../static/css/gateMana/common.css'\n// import '../../static/css/gateMana/dianziweilan.css'\nvar _default = {\n  created: function created() {\n    console.log('!!!!!!!!!!!!!');\n    this.filterForm.fenceId = this.$route.query.fenceId;\n    this.filterForm.fenceName = this.$route.query.fenceName;\n    this.getAlarmFro();\n  },\n  data: function data() {\n    return {\n      testData: [],\n      filterFormFro: {\n        tableData: [],\n        totalCount: 0\n      },\n      filterForm: {\n        fenceId: '',\n        fenceName: '',\n        queryCondition: '',\n        queryContent: '',\n        alarmType: '用户',\n        currentPage: 1\n      },\n      // 查询条件下的五个选项\n      options: [{\n        value: '1',\n        label: '围栏ID'\n      }, {\n        value: '2',\n        label: '围栏名称'\n      }, {\n        value: '3',\n        label: '分组ID'\n      }, {\n        value: '4',\n        label: '分组名称'\n      }, {\n        value: '5',\n        label: '日期'\n      }],\n      // 警报类型下拉菜单的两个选项\n      alarmTypeOptions: [{\n        value: '用户',\n        label: '用户'\n      }, {\n        value: '设备',\n        label: '设备'\n      }],\n      pickerOptions: {\n        shortcuts: [{\n          text: '今天',\n          onClick: function onClick(picker) {\n            picker.$emit('pick', new Date());\n          }\n        }, {\n          text: '昨天',\n          onClick: function onClick(picker) {\n            var date = new Date();\n            date.setTime(date.getTime() - 3600 * 1000 * 24);\n            picker.$emit('pick', date);\n          }\n        }, {\n          text: '一周前',\n          onClick: function onClick(picker) {\n            var date = new Date();\n            date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', date);\n          }\n        }]\n      },\n      tableWidth: '',\n      // 表格宽度\n      loadingText: '正在拼命加载中，请稍等......',\n      loading: false,\n      paginationVisible: true,\n      // 表格下方的分页显示\n      formLabelWidth: '150px',\n      deleteForm: {\n        alarmInfoId: ''\n      },\n      handleForm: {\n        alarmInfoId: ''\n      },\n      list: [],\n      states: [],\n      fileList: [],\n      showContent: true,\n      showDate: false,\n      multipleSelection: [],\n      withCredentials: true,\n      processing: false,\n      uploadTip: '点击上传',\n      importFlag: 1,\n      show: false,\n      dialogImportVisible: false,\n      errorResults: []\n    };\n  },\n  methods: {\n    /** ********************************* 页面处理数据格式等函数 ************************************************ */\n    // 分页页面跳转时\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.filterForm.currentPage = val;\n      this.getAlarmFro(this.filterForm.currentPage);\n    },\n    // 设置表头样式\n    tableHeaderClassName: function tableHeaderClassName(_ref) {\n      var row = _ref.row,\n          column = _ref.column,\n          rowIndex = _ref.rowIndex,\n          columnIndex = _ref.columnIndex;\n\n      if (rowIndex === 0) {\n        return 'headerClass';\n      }\n    },\n    // 设置表格每一行样式\n    tableRowClassName: function tableRowClassName(_ref2) {\n      var row = _ref2.row,\n          rowIndex = _ref2.rowIndex;\n      return 'rowClass';\n    },\n    // 点击表格中的“删除”按钮\n    handleDelete: function handleDelete(index, row) {\n      var _this = this;\n\n      this.deleteForm.alarmInfoId = row.alarmInfoId; // let data = this.filterFormFro.tableData[index]\n      // this.deleteForm.alarmInfoId = data.alarmInfoId\n\n      this.$confirm('确定删除该信息吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this.deleteAlarmFro();\n      }).catch(function () {\n        _this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n    // 点击表格中的“处理”按钮\n    handleAlarm: function handleAlarm(index, row) {\n      var _this2 = this;\n\n      this.handleForm.alarmInfoId = row.alarmInfoId;\n      this.$confirm('是否处理该报警信息?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this2.handleAlarmFro();\n      }).catch(function () {\n        _this2.$message({\n          type: 'info',\n          message: '已取消'\n        });\n      });\n    },\n    // 点击“导出”按钮\n    download: function download() {\n      var _this3 = this;\n\n      this.$confirm('确定导出数据吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this3.exportExcel();\n      }).catch(function () {\n        _this3.$message({\n          type: 'info',\n          message: '已取消导出'\n        });\n      });\n    },\n    // 重置表单\n    resetError: function resetError(formName) {\n      this.$nextTick(function () {\n        this.$refs[formName].resetFields();\n      });\n    },\n    // 重置表单\n    resetForm: function resetForm(formName) {\n      this.$nextTick(function () {\n        this.$refs[formName].resetFields();\n      });\n    },\n    // 将时间转化为字符串(filterForm)\n    formatDayFro: function formatDayFro(now) {\n      var year = now.getFullYear();\n      var month = now.getMonth() + 1;\n      month = month < 10 ? '0' + month : month;\n      var date = now.getDate();\n      date = date < 10 ? '0' + date : date; // var hour = now.getHours()\n      // hour = hour < 10 ? ('0' + hour) : hour\n      // var minute = now.getMinutes()\n      // minute = minute < 10 ? ('0' + minute) : minute\n      // var second = now.getSeconds()\n      // second = second < 10 ? ('0' + second) : second\n      // return year + '-' + month + '-' + date + ' ' + hour + ':' + minute + ':' + second\n\n      return year + '-' + month + '-' + date + ' ';\n    },\n    getConditionView: function getConditionView(value) {\n      if (value === '5') {\n        this.showDate = true;\n        this.showContent = false;\n      } else {\n        this.showContent = true;\n        this.showDate = false;\n      }\n\n      this.filterForm.queryContent = '';\n    },\n    // 导出\n    exportExcel: function exportExcel() {\n      /* generate workbook object from table */\n      var wb = _xlsx.default.utils.table_to_book(document.querySelector('#out-table'));\n      /* get binary string as output */\n\n\n      var wbout = _xlsx.default.write(wb, {\n        bookType: 'xlsx',\n        bookSST: true,\n        type: 'array'\n      });\n\n      try {\n        _fileSaver.default.saveAs(new Blob([wbout], {\n          type: 'application/octet-stream'\n        }), 'sheetjs.xlsx');\n      } catch (e) {\n        if (typeof console !== 'undefined') console.log(e, wbout);\n      }\n\n      return wbout;\n    },\n\n    /** ***************************** 向后台发送请求 ***************************************** */\n    // 查询警报信息\n    getAlarmFro: function getAlarmFro(pageNum) {\n      var _this4 = this;\n\n      this.loading = false;\n      var para = {\n        pageSize: 15,\n        pageNum: (0, _parseInt2.default)(this.filterForm.currentPage),\n        alarmType: this.filterForm.alarmType\n      };\n      pageNum ? this.filterForm.currentPage = pageNum : this.filterForm.currentPage = 1;\n\n      if (this.filterForm.queryCondition && this.filterForm.queryContent !== '') {\n        if (this.filterForm.queryCondition === '1') {\n          para.fenceId = (0, _parseInt2.default)(this.filterForm.queryContent);\n        } else if (this.filterForm.queryCondition === '2') {\n          para.fenceName = this.filterForm.queryContent;\n        } else if (this.filterForm.queryCondition === '3') {\n          para.groupId = this.filterForm.queryContent;\n        } else if (this.filterForm.queryCondition === '4') {\n          para.groupName = this.filterForm.queryContent;\n        } else if (this.filterForm.queryCondition === '5') {\n          if (this.filterForm.queryContent) {\n            para.data = this.formatDayFro(this.filterForm.queryContent);\n          } else {\n            para.date = null;\n          }\n        }\n      } else {\n        para.fenceId = null;\n        para.fenceName = null;\n        para.groupId = null;\n        para.groupName = null;\n        para.data = null;\n      }\n\n      console.log(para);\n\n      _api.default.getAlarm(para).then(function (res) {\n        _this4.filterFormFro.tableData = [];\n        _this4.loading = false;\n\n        if (res.result === 1000) {\n          var data = res.content;\n          data.allPages > 1 ? _this4.paginationVisible = true : _this4.paginationVisible = false;\n\n          if (data.list.length > 0) {\n            _this4.testData = data.list;\n            _this4.filterFormFro.tableData = data.list;\n            _this4.filterFormFro.totalCount = data.allCount;\n\n            for (var i = 0; i < _this4.filterFormFro.tableData.length; i++) {\n              _this4.filterFormFro.tableData[i].index = (_this4.filterForm.currentPage - 1) * 15 + i + 1;\n              _this4.filterFormFro.tableData[i].alarmTime = _this4.formatDayFro(new Date(_this4.filterFormFro.tableData[i].alarmTime));\n\n              if (_this4.filterFormFro.tableData[i].isDeal === true) {\n                _this4.filterFormFro.tableData[i].isDeal = '已处理';\n              } else {\n                _this4.filterFormFro.tableData[i].isDeal = '未处理';\n              }\n            }\n          } else {\n            _this4.$message.warning('没有查到任何警报信息');\n          }\n        } else {\n          _this4.$message.error(res.resultDesp);\n        }\n      }).catch(function (error) {\n        _this4.loading = false;\n\n        _this4.$message.error(error);\n      });\n    },\n    // 删除报警信息\n    deleteAlarmFro: function deleteAlarmFro() {\n      var _this5 = this;\n\n      var para = {\n        alarmInfoId: (0, _parseInt2.default)(this.deleteForm.alarmInfoId)\n      };\n      console.log('delete');\n      console.log(para);\n\n      _api.default.deleteAlarm(para).then(function (res) {\n        if (res.result === 1000) {\n          _this5.deleteVisable = false;\n\n          _this5.$message.success('删除警报信息成功');\n\n          _this5.getAlarmFro();\n        } else {\n          _this5.$message.warning(res.resultDesp);\n        }\n      }).catch(function (error) {\n        _this5.deleteVisable = false;\n\n        _this5.$message.error(error);\n      });\n    },\n    // 处理报警信息\n    handleAlarmFro: function handleAlarmFro() {\n      var _this6 = this;\n\n      var para = {\n        alarmInfoId: (0, _parseInt2.default)(this.handleForm.alarmInfoId)\n      };\n      console.log('deal');\n      console.log(para);\n\n      _api.default.handleAlarm(para).then(function (res) {\n        if (res.result === 1000) {\n          _this6.deleteVisable = false;\n\n          _this6.$message.success('报警信息已处理');\n\n          _this6.getAlarmFro();\n        } else {\n          _this6.$message.warning(res.resultDesp);\n        }\n      }).catch(function (error) {\n        _this6.deleteVisable = false;\n\n        _this6.$message.error(error);\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.tableWidth = document.body.scrollWidth - 259 - 20;\n  }\n};\nexports.default = _default;",null]}